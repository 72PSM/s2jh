var Grid=function(){var a=false;return{initGridDefault:function(){$.extend($.ui.multiselect,{locale:{addAll:"全部添加",removeAll:"全部移除",itemsCount:"已选择项目列表"}});$.extend($.jgrid.ajaxOptions,{dataType:"json"});$.extend($.jgrid.defaults,{datatype:"json",loadui:false,loadonce:false,filterToolbar:{},ignoreCase:true,prmNames:{npage:"npage"},jsonReader:{repeatitems:false,root:"content",total:"totalPages",records:"totalElements"},treeReader:{level_field:"extraAttributes.level",parent_id_field:"extraAttributes.parent",leaf_field:"extraAttributes.isLeaf",expanded_field:"extraAttributes.expanded",loaded:"extraAttributes.loaded",icon_field:"extraAttributes.icon"},autowidth:true,rowNum:15,page:1,altclass:"ui-jqgrid-evennumber",height:"auto",viewsortcols:[true,"vertical",true],mtype:"GET",viewrecords:true,rownumbers:true,toppager:true,recordpos:"left",gridview:true,altRows:true,sortable:false,multiboxonly:true,multiselect:true,multiSort:false,forceFit:true,shrinkToFit:true,sortorder:"desc",sortname:"createdDate",ajaxSelectOptions:{cache:true},loadError:function(d,e,b,c){Global.notify("error","表格数据加载处理失败,请尝试刷新或联系管理员!")},subGridOptions:{reloadOnExpand:false}});$.extend($.jgrid.search,{multipleSearch:true,multipleGroup:true,width:700,jqModal:false,searchOperators:true,stringResult:true,searchOnEnter:true,defaultSearch:"bw",operandTitle:"点击选择查询方式",operands:{eq:"=",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^","in":"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#"}});$.extend($.jgrid.del,{serializeDelData:function(b){b.ids=b.id;b.id="";return b},errorTextFormat:function(c){var b=jQuery.parseJSON(c.responseText);return b.message},afterComplete:function(d){var c=new Array();var b=jQuery.parseJSON(d.responseText);if(b.type=="success"){top.$.publishMessage(b.message);c[0]=true}else{top.$.publishError(b.message);c[0]=false}return c},ajaxDelOptions:{dataType:"json"}});$.jgrid.extend({bindKeys:function(b){var c=$.extend({upKey:true,downKey:true,onEnter:null,onSpace:null,onLeftKey:null,onRightKey:null,scrollingRows:true},b||{});return this.each(function(){var d=this;if(!$("body").is("[role]")){$("body").attr("role","application")}d.p.scrollrows=c.scrollingRows;$(d).keydown(function(h){var l=$(d).find("tr[tabindex=0]")[0],n,g,m,f=d.p.treeReader.expanded_field;if(l){m=d.p._index[$.jgrid.stripPref(d.p.idPrefix,l.id)];if(h.keyCode===37||h.keyCode===38||h.keyCode===39||h.keyCode===40){if(h.keyCode===38&&c.upKey){g=l.previousSibling;n="";if(g){if($(g).is(":hidden")){while(g){g=g.previousSibling;if(!$(g).is(":hidden")&&$(g).hasClass("jqgrow")){n=g.id;break}}}else{n=g.id}}$(d).jqGrid("setSelection",n,true,h);h.preventDefault()}if(h.keyCode===40&&c.downKey){g=l.nextSibling;n="";if(g){if($(g).is(":hidden")){while(g){g=g.nextSibling;if(!$(g).is(":hidden")&&$(g).hasClass("jqgrow")){n=g.id;break}}}else{n=g.id}}$(d).jqGrid("setSelection",n,true,h);h.preventDefault()}if(h.keyCode===37){if(d.p.treeGrid&&d.p.data[m][f]){$(l).find("div.treeclick").trigger("click")}$(d).triggerHandler("jqGridKeyLeft",[d.p.selrow]);if($.isFunction(c.onLeftKey)){c.onLeftKey.call(d,d.p.selrow)}}if(h.keyCode===39){if(d.p.treeGrid&&!d.p.data[m][f]){$(l).find("div.treeclick").trigger("click")}$(d).triggerHandler("jqGridKeyRight",[d.p.selrow]);if($.isFunction(c.onRightKey)){c.onRightKey.call(d,d.p.selrow)}}}else{if(h.keyCode===13){var e=h.target;if(e.tagName==="TEXTAREA"){return true}h.stopPropagation();$(d).triggerHandler("jqGridKeyEnter",[d.p.selrow]);if($.isFunction(c.onEnter)){c.onEnter.call(d,d.p.selrow)}}else{if(h.keyCode===32){h.stopPropagation();$(d).triggerHandler("jqGridKeySpace",[d.p.selrow]);if($.isFunction(c.onSpace)){c.onSpace.call(d,d.p.selrow)}}else{if(h.keyCode===27){h.stopPropagation();$(d).jqGrid("restoreRow",d.p.selrow,c.afterrestorefunc);$(d).jqGrid("showAddEditButtons")}}}}}})})},refresh:function(){this.each(function(){var b=this;if(!b.grid){return}$(b).jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")})},search:function(b){this.each(function(){var e=this;if(!e.grid){return}var c=$(e).jqGrid("getGridParam","url");for(var d in b){c=AddOrReplaceUrlParameter(c,d,b[d])}$(e).jqGrid("setGridParam",{url:c,page:1}).trigger("reloadGrid")})},exportExcelLocal:function(b){this.each(function(){var f=this;if(!f.grid){return}if(!confirm("确认导出当前页面 "+f.p.caption+" 数据为Excel下载文件？")){return}var e=new Array();e=$(f).getDataIDs();var m=f.p.colModel;var p=f.p.colNames;var h="";for(k=0;k<p.length;k++){var n=m[k];if(n.hidedlg||n.hidden||n.disableExport){continue}h=h+p[k]+"\t"}h=h+"\n";for(i=0;i<e.length;i++){data=$(f).getRowData(e[i]);for(j=0;j<p.length;j++){var n=m[j];if(n.hidedlg||n.hidden||n.disableExport){continue}var g=data[n.name];var l=null;if(n.searchoptions&&n.searchoptions.value){l=n.searchoptions.value}else{if(n.editoptions&&n.editoptions.value){l=n.editoptions.value}}if(l){g=l[g]}if(g.indexOf("<")>-1&&g.indexOf(">")>-1){g=$(g).text()}if(g==""){g=data[n.name]}if(g=="null"||g==null){g=""}g=g.replace(/\&nbsp;/g,"");h=h+g+"\t"}h=h+"\n"}h=h+"\n";var c=$('<form method="post" target = "_blank" action="'+WEB_ROOT+'/pub/grid!export"></form>').appendTo($("body"));var o=$('<input type="hidden" name="exportDatas"/>').appendTo(c);var d=$('<input type="hidden" name="fileName"/>').appendTo(c);d.val("export-data.xls");o.val(h);c.submit();c.remove()})},refreshRowIndex:function(){var b=$(this);$.each($(b).jqGrid("getDataIDs"),function(c,d){$(b).find("#"+d).find("input,select").each(function(){var e=$(this).attr("name");$(this).attr("name",e.substring(0,e.indexOf("[")+1)+c+e.substring(e.indexOf("]"),e.length))})})},getAtLeastOneSelectedItem:function(g){var f=$(this);var d=[];var e=jQuery(f).jqGrid("getGridParam","selarrrow");if(e.length>0){for(var b=0;b<e.length;b++){var c=$("#jqg_"+jQuery(f).attr("id")+"_"+e[b]).is(":disabled");if(!c){d.push(e[b])}}}else{var h=jQuery(f).jqGrid("getGridParam","selrow");if(h){d.push(h)}}if(g){jQuery(f).find("table.jqsubgrid").each(function(){var n=$(this).jqGrid("getGridParam","selarrrow");for(var l=0;l<n.length;l++){var m=$("#jqg_"+jQuery(this).attr("id")+"_"+e[l]).is(":disabled");if(!m){d.push(n[l])}}})}if(d.length==0){Global.notify("error","请至少选择一条行项目！");return false}else{return d}},getOnlyOneSelectedItem:function(g){var f=$(this);var d=[];var e=jQuery(f).jqGrid("getGridParam","selarrrow");if(e.length>0){for(var b=0;b<e.length;b++){var c=$("#jqg_"+jQuery(f).attr("id")+"_"+e[b]).is(":disabled");if(!c){d.push(e[b])}}}else{var h=jQuery(f).jqGrid("getGridParam","selrow");if(h){d.push(h)}}if(d.length==0){if(g){toastr.error("请选取操作项目！")}return false}else{if(d.length>1){toastr.error("只能选择一条操作项目！");return false}return d[0]}},getSelectedItem:function(){var c=$(this);var b=jQuery(c).jqGrid("getGridParam","selarrrow");return b.join()},getSelectedRowdatas:function(){var b=$(this);var c=[];var e=b.jqGrid("getGridParam","selarrrow");if(e){$.each(e,function(g,h){var l=b.jqGrid("getRowData",h);l.id=h;c.push(l)})}else{var d=b.jqGrid("getGridParam","selrow");if(d){var f=b.jqGrid("getRowData",d);f.id=d;c.push(f)}}return c},getSelectedRowdata:function(){var b=$(this);var c=b.jqGrid("getGridParam","selrow");if(c){return b.jqGrid("getRowData",c)}},getDirtyRowdatas:function(){var l=$(this);var g=[];var f=l.jqGrid("getGridParam","colModel");var d=[];$.each(f,function(o,n){if(n.editable){d.push(n.name)}});var b=l.jqGrid("getDataIDs");var h=0;$.each(b,function(n,o){if(!Util.startWith(o,"-")&&o!=""){h++}});var e=BooleanUtil.toBoolean(l.attr("data-clone"));$.each(b,function(n,q){var p=l.jqGrid("getRowData",q);if(BooleanUtil.toBoolean(p["extraAttributes.dirtyRow"])){if(Util.startWith(q,"-")){q=""}var o={id:q};$.each(d,function(s,r){o[r]=p[r]});o._arrayIndex=p._arrayIndex;if(p["extraAttributes.operation"]){o["extraAttributes.operation"]=p["extraAttributes.operation"]}g.push(o)}});var m=l.jqGrid("getGridParam","batchEntitiesPrefix");if(m){var c={};$.each(g,function(n,p){var o=p._arrayIndex;delete p._arrayIndex;if(o==undefined||o==""){o=h;h++}$.each(p,function(r,q){c[m+"["+o+"]."+r]=q})});return c}return g},insertNewRowdata:function(f){var b=$(this);var e=null;var d=b.jqGrid("getDataIDs");$.each(d,function(g,l){var h=b.jqGrid("getRowData",l);if(!BooleanUtil.toBoolean(h["extraAttributes.dirtyRow"])){e=l;return false}});var c=-Math.floor(new Date().getTime()+Math.random()*100+100);f["extraAttributes.dirtyRow"]=true;if(e){b.jqGrid("addRowData",c,f,"before",e)}else{b.jqGrid("addRowData",c,f,"last")}return c},setEditingRowdata:function(l,c){var b=$(this);var d=b.find("tbody");for(var f in l){var g="input[name='"+f+"'],select[name='"+f+"'],textarea[name='"+f+"']";var e=d.find(g);if(c==false){if($.trim(e.val())!=""){continue}}var h=l[f];e.val(h).attr("title",h);if(e.is("select")){e.select2({openOnEnter:false,placeholder:"请选择...",matcher:function(n,q){var m=makePy(q)+"";var p=m.toUpperCase().indexOf(n.toUpperCase())==0;var o=q.toUpperCase().indexOf(n.toUpperCase())==0;return(p||o)}})}}},getEditingRowdata:function(){var b=$(this);var d=b.find("tbody");var e={};var c="input,select,textarea";d.find(c).each(function(){var f=$(this);e[f.attr("name")]=f.val()});return e},isEditingMode:function(d){var b=$(this);var c=b.find('tr[editable="1"]');if(c.size()>0){if(d==undefined){return true}if(d===true){alert("请先保存或取消正在编辑的表格数据行项后再操作")}else{alert(d)}return true}return false},sumColumn:function(d,f){var b=$(this);if(f==undefined){f=2}var e=b.jqGrid("getCol",d,false,"sum");var c=Math.pow(10,f);return Math.round(e*c)/c},getDataFromBindSeachForm:function(d){var b=$(this);var c=b.jqGrid("getGridParam","bindSearchFormData");var e=c[d];return e},inlineNav:function(b,c){c=$.extend(true,{edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",save:true,saveicon:"ui-icon-disk",cancel:true,cancelicon:"ui-icon-cancel",del:true,delicon:"ui-icon-trash",addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:true},$.jgrid.nav,c||{});return this.each(function(){if(!this.grid){return}var n=this,f,l=$.jgrid.jqID(n.p.id),e=$(n.p.toppager).attr("id");n.p._inlinenav=true;if(c.addParams.useFormatter===true){var d=n.p.colModel,h;for(h=0;h<d.length;h++){if(d[h].formatter&&d[h].formatter==="actions"){if(d[h].formatoptions){var m={keys:false,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},g=$.extend(m,d[h].formatoptions);c.addParams.addRowParams={keys:g.keys,oneditfunc:g.onEdit,successfunc:g.onSuccess,url:g.url,extraparam:g.extraparam,aftersavefunc:g.afterSave,errorfunc:g.onError,afterrestorefunc:g.afterRestore}}break}}}$(n).jqGrid("navSeparatorAdd",b);if(n.p.toppager){$(n).jqGrid("navSeparatorAdd",n.p.toppager)}if(c.add){$(n).jqGrid("navButtonAdd",b,{caption:c.addtext,title:c.addtitle,buttonicon:c.addicon,id:n.p.id+"_iladd",onClickButton:function(){var q=$(n).getOnlyOneSelectedItem(false);if(q){var r=$(n).getRowData(q);c.addParams.initdata=r;var o=n.p.colModel,p;for(p=0;p<o.length;p++){if(o[p].editcopy==false){delete c.addParams.initdata[o[p].name]}else{if(o[p].editcopy=="append"){c.addParams.initdata[o[p].name]=r[o[p].name]+"_COPY"}}}$(n).jqGrid("resetSelection")}else{c.addParams.initdata={id:""}}c.addParams.rowID=-(new Date().getTime());$(n).jqGrid("addRow",c.addParams);if(!c.addParams.useFormatter){$("#"+l+"_ilsave").removeClass("ui-state-disabled");$("#"+l+"_ilcancel").removeClass("ui-state-disabled");$("#"+l+"_iladd").addClass("ui-state-disabled");$("#"+l+"_iledit").addClass("ui-state-disabled");$("#"+l+"_toppager_ilsave").removeClass("ui-state-disabled");$("#"+l+"_toppager_ilcancel").removeClass("ui-state-disabled");$("#"+l+"_toppager_iladd").addClass("ui-state-disabled");$("#"+l+"_toppager_iledit").addClass("ui-state-disabled")}}});if(n.p.toppager){$(n).jqGrid("navButtonAdd",n.p.toppager,{caption:c.addtext,title:c.addtitle,buttonicon:c.addicon,id:e+"_iladd",onClickButton:function(){$(".ui-icon-plus",$(n.p.pager)).click()}})}}if(c.edit){$(n).jqGrid("navButtonAdd",b,{caption:c.edittext,title:c.edittitle,buttonicon:c.editicon,id:n.p.id+"_iledit",onClickButton:function(){var o=$(n).getOnlyOneSelectedItem();if(o){if($("#"+o,$(n)).hasClass("not-editable-row")){alert("提示：当前行项不可编辑");return}$(n).jqGrid("editRow",o,c.editParams);$("#"+l+"_ilsave").removeClass("ui-state-disabled");$("#"+l+"_ilcancel").removeClass("ui-state-disabled");$("#"+l+"_iladd").addClass("ui-state-disabled");$("#"+l+"_iledit").addClass("ui-state-disabled");$("#"+l+"_toppager_ilsave").removeClass("ui-state-disabled");$("#"+l+"_toppager_ilcancel").removeClass("ui-state-disabled");$("#"+l+"_toppager_iladd").addClass("ui-state-disabled");$("#"+l+"_toppager_iledit").addClass("ui-state-disabled")}}});if(n.p.toppager){$(n).jqGrid("navButtonAdd",n.p.toppager,{caption:c.edittext,title:c.edittitle,buttonicon:c.editicon,id:e+"_iledit",onClickButton:function(){$(".ui-icon-pencil",$(n.p.pager)).click()}})}}if(c.save){$(n).jqGrid("navButtonAdd",b,{caption:c.savetext||"",title:c.savetitle||"保存编辑行项",buttonicon:c.saveicon,id:n.p.id+"_ilsave",onClickButton:function(){var p=n.p.savedRow[0]?n.p.savedRow[0].id:false;if(p){var o=n.p.prmNames,r=o.oper,q={};if($("#"+$.jgrid.jqID(p),"#"+l).hasClass("jqgrid-new-row")){c.addParams.addRowParams.extraparam[r]=o.addoper;q=c.addParams.addRowParams;q.extraparam.id=""}else{if(!c.editParams.extraparam){c.editParams.extraparam={}}c.editParams.extraparam[r]=o.editoper;q=c.editParams}q.extraparam["extraAttributes.dirtyRow"]=true;if($(n).jqGrid("saveRow",p,q)){$(n).jqGrid("showAddEditButtons")}}}});$("#"+l+"_ilsave").addClass("ui-state-disabled");if(n.p.toppager){$(n).jqGrid("navButtonAdd",n.p.toppager,{caption:c.savetext||"",title:c.savetitle||"保存编辑行项",buttonicon:c.saveicon,id:e+"_ilsave",onClickButton:function(){$(".ui-icon-disk",$(n.p.pager)).click()}});$("#"+l+"_toppager_ilsave").addClass("ui-state-disabled")}}if(c.cancel){$(n).jqGrid("navButtonAdd",b,{caption:c.canceltext||"",title:c.canceltitle||"放弃正在编辑行项",buttonicon:c.cancelicon,id:n.p.id+"_ilcancel",onClickButton:function(){var p=n.p.savedRow[0]?n.p.savedRow[0].id:false,o={};if(p){if($("#"+$.jgrid.jqID(p),"#"+l).hasClass("jqgrid-new-row")){o=c.addParams.addRowParams}else{o=c.editParams}$(n).jqGrid("restoreRow",p,o)}$(n).jqGrid("resetSelection");$(n).jqGrid("showAddEditButtons")}});if(n.p.toppager){$(n).jqGrid("navButtonAdd",n.p.toppager,{caption:c.canceltext||"",title:c.canceltitle||"放弃正在编辑行项",buttonicon:c.cancelicon,id:e+"_ilcancel",onClickButton:function(){$(".ui-icon-cancel",$(n.p.pager)).click()}})}}if(c.del){$(n).jqGrid("navSeparatorAdd",b);$(n).jqGrid("navButtonAdd",b,{caption:c.deltext||"",title:c.deltitle||"删除所选行项",buttonicon:c.delicon,id:n.p.id+"_ildel",onClickButton:function(){if(!$(this).hasClass("ui-state-disabled")){var p=$(n).getAtLeastOneSelectedItem();if(p){$(n).jqGrid("restoreRow",p);if($.isFunction(c.delfunc)){c.delfunc.call(n,p)}else{if(n.p.delurl==undefined||n.p.delurl=="clientArray"){$.each(p,function(r,u){if(Util.startWith(u,"-")){$(n).jqGrid("delRowData",u)}else{var s=$(n).find("#"+u);var t=$(n).jqGrid("getRowData",u);for(var q in t){if(q=="id"||Util.endWith(q,".id")||q=="_arrayIndex"){}else{if(q=="extraAttributes.dirtyRow"){t[q]=true}else{if(q=="extraAttributes.operation"){t[q]="remove"}else{t[q]=""}}}}$(n).jqGrid("setRowData",u,t);s.hide()}if(n.p.afterInlineDeleteRow){n.p.afterInlineDeleteRow.call($(n),u)}})}else{var p=$(n).getAtLeastOneSelectedItem();if(p){var o=Util.AddOrReplaceUrlParameter(n.p.delurl,"ids",p.join(","));$(n).ajaxPostURL(o,function(q){$.each(p,function(r,t){var t=$.trim(t);var s=$(n).find("tr.jqgrow[id='"+t+"']");if(q.userdata&&q.userdata[t]){var u=q.userdata[t];s.pulsate({color:"#bf1c56",repeat:3})}else{$(n).jqGrid("delRowData",t)}})},"确认批量删除所选记录吗？")}}}$(n).jqGrid("showAddEditButtons")}else{$.jgrid.viewModal("#"+alertIDs.themodal,{gbox:"#gbox_"+$.jgrid.jqID(n.p.id),jqm:true});$("#jqg_alrt").focus()}}return false}});if(n.p.toppager){$(n).jqGrid("navSeparatorAdd",n.p.toppager);$(n).jqGrid("navButtonAdd",n.p.toppager,{caption:c.deltext||"",title:c.deltitle||"删除所选行项",buttonicon:c.delicon,id:e+"_ildel",onClickButton:function(){$(".ui-icon-trash",$(n.p.pager)).click()}})}}if(c.restoreAfterSelect===true){if($.isFunction(n.p.beforeSelectRow)){f=n.p.beforeSelectRow}else{f=false}n.p.beforeSelectRow=function(q,p){var o=true;if(n.p.savedRow.length>0&&n.p._inlinenav===true&&(q!==n.p.selrow&&n.p.selrow!==null)){if(n.p.selrow===c.addParams.rowID){$(n).jqGrid("delRowData",n.p.selrow)}else{$(n).jqGrid("restoreRow",n.p.selrow,c.editParams)}$(n).jqGrid("showAddEditButtons")}if(f){o=f.call(n,q,p)}return o}}$(n).jqGrid("showAddEditButtons")})},showAddEditButtons:function(){return this.each(function(){if(!this.grid){return}var b=$.jgrid.jqID(this.p.id);$("#"+b+"_ilsave").addClass("ui-state-disabled");$("#"+b+"_ilcancel").addClass("ui-state-disabled");$("#"+b+"_iladd").removeClass("ui-state-disabled");$("#"+b+"_iledit").removeClass("ui-state-disabled");$("#"+b+"_toppager_ilsave").addClass("ui-state-disabled");$("#"+b+"_toppager_ilcancel").addClass("ui-state-disabled");$("#"+b+"_toppager_iladd").removeClass("ui-state-disabled");$("#"+b+"_toppager_iledit").removeClass("ui-state-disabled")})}});a=true},initAjax:function(b){if(b==undefined){b=$("body")}$('table[data-grid="table"],table[data-grid="items"]',b).each(function(){Grid.initGrid($(this))})},initGrid:function(T,C){if(!a){Grid.initGridDefault()}var ad=$(T);if(ad.hasClass("ui-jqgrid-btable")){return}if(ad.attr("id")==undefined){ad.attr("id","grid_"+new Date().getTime())}if(C==undefined&&ad.data("gridOptions")==undefined){alert("Grid options undefined");return}var v=$.extend(true,{},ad.data("gridOptions"),C);var c=ad.attr("data-grid");var F=null;var Y=ad.attr("id")+"-context-menu-container";var U=null;var e=(Util.notSmallViewport()?true:false);if(e){e=(c=="items"?false:true)}var G=(Util.notSmallViewport()?{}:false);if(G){G=(c=="items"?false:true)}var I=$.extend(true,{},$.jgrid.defaults,{formatter:{integer:{defaultValue:""},number:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:""},currency:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:""}},cmTemplate:{sortable:c=="items"?false:true},viewsortcols:c=="items"?[true,"vertical",false]:[true,"vertical",true],altRows:c=="items"?false:true,hoverrows:c=="items"?false:true,pgbuttons:c=="items"?false:true,pginput:c=="items"?false:true,rowList:c=="items"?[]:[10,15,20,50,100,200,500,1000,2000],inlineNav:{add:v.editurl||c=="items"?true:false,edit:v.editurl||c=="items"?true:false,del:v.delurl||c=="items"?true:false,restoreAfterSelect:c=="items"?false:true,addParams:{addRowParams:{extraparam:{},restoreAfterError:false,beforeSaveRow:function(am){if(I.beforeInlineSaveRow){I.beforeInlineSaveRow.call(ad,am)}},aftersavefunc:function(ao,ap){if(I.editurl=="clientArray"){ad.jqGrid("resetSelection");if(I.afterInlineSaveRow){I.afterInlineSaveRow.call(ad,ao)}setTimeout(function(){$("#"+F).find(".ui-pg-div span.ui-icon-plus").click()},200);return}var an=jQuery.parseJSON(ap.responseText);if(an.type=="success"||an.type=="warning"){Global.notify(an.type,an.message);var am=an.userdata.id;ad.find("#"+ao).attr("id",am);ad.jqGrid("resetSelection");ad.jqGrid("setSelection",am);if(I.afterInlineSaveRow){I.afterInlineSaveRow.call(ad,ao)}setTimeout(function(){$("#"+F).find(".ui-pg-div span.ui-icon-plus").click()},200)}else{if(an.type=="failure"||an.type=="error"){Global.notify("error",an.message)}else{Global.notify("error","数据处理异常，请联系管理员")}}},errorfunc:function(an,ao){var am=jQuery.parseJSON(ao.responseText);Global.notify("error",am.message)}}},editParams:{restoreAfterError:false,beforeSaveRow:function(am){if(I.beforeInlineSaveRow){I.beforeInlineSaveRow.call(ad,am)}},oneditfunc:function(aq){var an=ad.jqGrid("getGridParam","iCol");var am=ad.jqGrid("getGridParam","colModel")[an];var ap=ad.find("tr#"+aq);var ar=ap.find("> td:eq("+an+")");var ao=ar.find("input:visible:first");if(ao.size()>0&&ao.attr("readonly")==undefined){setTimeout(function(){ao.focus()},200)}else{ap.find("input:visible:enabled:first").focus()}},aftersavefunc:function(an,aq){var ap=true;if(I.editurl!="clientArray"){var am=jQuery.parseJSON(aq.responseText);if(am.type=="success"||am.type=="warning"){Global.notify(am.type,am.message)}else{if(am.type=="failure"||am.type=="error"){Global.notify("error",am.message);ap=false}else{Global.notify("error","数据处理异常，请联系管理员");ap=false}}}if(ap){if(I.afterInlineSaveRow){I.afterInlineSaveRow.call(ad,an)}if(I.editurl!="clientArray"){var ao=ad.find("tr.jqgrow[id='"+an+"']").next("tr");if(ao.size()>0){var ar=ao.attr("id");ad.jqGrid("resetSelection");ad.jqGrid("setSelection",ar);setTimeout(function(){$("#"+F).find(".ui-pg-div span.ui-icon-pencil").click()},200)}}}},errorfunc:function(an,ao){var am=jQuery.parseJSON(ao.responseText);Global.notify("error",am.message)}}},filterToolbar:G,multiselect:e,contextMenu:true,columnChooser:true,exportExcelLocal:true,loadBeforeSend:function(){App.blockUI(ad.closest(".ui-jqgrid"))},subGridBeforeExpand:function(){var am=ad.closest(".ui-jqgrid-bdiv");am.css({height:"auto"})},loadComplete:function(ao){ad.jqGrid("showAddEditButtons");if(ao.total==undefined&&ao.totalElements==undefined){alert("表格数据格式不正确");return}if(ao&&ao.content){$.each(ao.content,function(ap,aq){ad.setRowData(aq.id,{_arrayIndex:ap})});if(ao.totalElements>=(2147473647-10000)){ad.closest(".ui-jqgrid-view").find("div.ui-jqgrid-pager,div.ui-jqgrid-toppager .ui-pg-table td[id^='last_']").addClass("ui-state-disabled")}}if(c=="items"&&I.inlineNav.add!=false){for(var an=1;an<=3;an++){ad.addRowData(-an,{})}}if(X=="enable"&&I.contextMenu&&U.find("li").length>0){ad.find("tr.jqgrow").each(function(){$(this).contextmenu({target:"#"+Y,onItem:function(ar,aq){var ap=$(aq).attr("role-idx");U.find('a[role-idx="'+ap+'"]').click();return true}})})}if(I.footerLocalDataColumn){$.each(I.footerLocalDataColumn,function(aq,at){var ar=ad.jqGrid("sumColumn",at);var ap=[];ap[at]=ar;ad.footerData("set",ap)})}if(X=="enable"&&I.contextMenu&&U.find("li").length>0){ad.find("tr.jqgrow").each(function(){$(this).contextmenu({target:"#"+Y,onItem:function(ar,aq){var ap=$(aq).attr("role-idx");U.find('a[role-idx="'+ap+'"]').click();return true}})})}if(ad.attr("data-selected")){ad.jqGrid("setSelection",ad.attr("data-selected"),false)}var am=v.userLoadComplete;if(am){am.call(ad,ao)}$('[data-hover="dropdown"]',ad.closest(".ui-jqgrid")).dropdownHover();App.unblockUI(ad.closest(".ui-jqgrid"))},beforeSelectRow:function(ao){if(I.inlineNav.restoreAfterSelect==false){var an=ad.jqGrid("getGridParam","selrow");var am=ad.find("tr#"+an).attr("editable");if(an&&an!=ao&&am=="1"){$("#"+F).find(".ui-pg-div span.ui-icon-disk").click();return false}}return true},onSelectRow:function(ao,am,an){ad.find("tr.jqgrow").attr("tabindex",-1);ad.find("tr.jqgrow[id='"+ao+"']").attr("tabindex",0);if(c=="items"){$("#"+F).find(".ui-pg-div span.ui-icon-pencil").click()}},onCellSelect:function(an,am){ad.jqGrid("setGridParam",{iCol:am})},ondblClickRow:function(ap,ar,an,aq){var am=$("#"+F).find("i.fa-edit").parent("a");if(am.size()>0){am.click()}else{if(c!="items"){var ao=$("#"+F).find(".ui-pg-div span.ui-icon-pencil");if(ao.size()>0){ao.click()}else{$("#"+F).find("i.fa-credit-card").parent("a").click()}}}aq.stopPropagation()}},v);if($.isFunction(I.url)){I.url=I.url.call(ad)}if(I.url==undefined){I.url=ad.attr("data-url")}if(I.url==undefined){I.datatype="local"}if(BooleanUtil.toBoolean(ad.attr("data-readonly"))){I.inlineNav.add=false;I.inlineNav.edit=false;I.inlineNav.del=false}if(I.pager==undefined||I.pager){F=ad.attr("id")+"_pager";$("<div id='"+F+"'/>").insertAfter(ad);I.pager="#"+F}else{I.toppager=false}if(I.toppager){I.toppager="#"+ad.attr("id")+"_toppager"}if(I.treeGrid){I.rownumbers=false}if(v.editurl==undefined&&c=="items"){I.editurl="clientArray"}if(v.delurl==undefined&&c=="items"){I.delurl="clientArray"}if(I.editurl=="clientArray"){I.cellsubmit=I.editurl}else{I.cellurl=I.editurl}var Q=0;var P=false;var O=false;var R=[];$.each(I.colModel,function(ap,am){if(am.frozen){P=true}am=$.extend(true,{editoptions:{rows:1},searchoptions:{clearSearch:true,searchhidden:true,sopt:["cn","bw","bn","eq","ne","nc","ew","en"],defaultValue:"",buildSelect:function(aw){var av=jQuery.parseJSON(aw);if(av==null){av=aw}var au="<select>";au+="<option value=''></option>";for(var at in av){at=at+"";au+=("<option value='"+at+"'>"+av[at]+"</option>")}au+="</select>";return au}}},am);if(am.name=="id"){O=true}if(am.responsive){if(am.hidden==undefined){var ao=$(window).width();var ar=am.responsive;if(ar=="sm"){if(ao<768){am.hidden=true}}else{if(ar=="md"){if(ao<992){am.hidden=true}}else{if(ar=="lg"){if(ao<1200){am.hidden=true}}}}}}if(am.formatter=="currency"){am=$.extend(true,{width:80,align:"right",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"",defaultValue:""}},am);am.searchoptions=$.extend(true,am.searchoptions,{sopt:["eq","ne","ge","le","gt","lt"]})}if(am.formatter=="percentage"){am=$.extend(true,{width:50,align:"right"},am);am.formatter=function(av,at,aw,au){if(av){return Math.round(av*10000)/100+"%"}else{return av}}}if(am.stype=="date"){am.sorttype="date"}if(am.sorttype=="date"){am=$.extend(true,{width:150,fixed:true,align:"center"},am);if(am.dateformat==undefined){am.dateformat="yyyy-mm-dd"}am.searchoptions=$.extend(true,am.searchoptions,{sopt:["eq","ne","ge","le","gt","lt"],dataInit:function(at){$(at).datepicker({language:"zh-CN",autoclose:true,format:am.dateformat})}});am.editoptions=$.extend(am.editoptions,{dataInit:function(at){if(am.editoptions.time){$(at).datetimepicker({autoclose:true,todayBtn:true,minuteStep:10})}else{$(at).datepicker({language:"zh-CN",autoclose:true,format:am.dateformat})}}})}if(am.sorttype=="number"||am.edittype=="number"||am.formatter=="number"){am=$.extend(true,{width:60,align:"center",formatoptions:{defaultValue:""}},am);am.searchoptions=$.extend(true,am.searchoptions,{sopt:["eq","ne","ge","le","gt","lt"]})}if(am.name=="id"){am=$.extend(true,{width:80,align:"center",title:false,formatter:function(aw,au,ay,av){if(aw&&aw.length>5){var at=aw.length;var ax=aw.substring(at-5,at);return"<span data='"+aw+"' onclick='$(this).html($(this).attr(\"data\"))'>..."+ax+"</span>"}else{return"<span>"+aw+"</span>"}},frozen:true},am);am.searchoptions=$.extend(true,am.searchoptions,{sopt:["eq","ne","ge","le","gt","lt"]})}if(am.formatter=="checkbox"&&am.edittype==undefined){am.edittype="checkbox"}if(am.edittype=="checkbox"&&am.formatter==undefined){am.formatter="checkbox"}if(am.edittype=="checkbox"){am=$.extend(true,{formatter:"checkbox",stype:"select"},am);am.searchoptions.value={"":"","true":"Y","false":"N"};am.editoptions.value="true:false"}if(am.edittype==undefined||am.edittype=="text"||am.edittype=="select"||am.edittype=="textarea"){var aq=am.editoptions.dataInit;am.editoptions=$.extend(am.editoptions,{dataInit:function(at){if(aq){aq.call(this,at)}$(at).removeClass("editable").addClass("form-control").attr("autocomplete","off").css({width:"100%"});if($(at).is("input[type='text']")){$(at).blur(function(){$(at).val($.trim($(at).val()))})}if($(at).is("select")){$(at).select2({openOnEnter:false,placeholder:"请选择...",matcher:function(av,ay){var au=makePy(ay)+"";var ax=au.toUpperCase().indexOf(av.toUpperCase())==0;var aw=ay.toUpperCase().indexOf(av.toUpperCase())==0;return(ax||aw)}})}if(am.editoptions.spellto){$(at).change(function(){var au={};au[am.editoptions.spellto]=Pinyin.getCamelChars($.trim($(at).val()));ad.jqGrid("setEditingRowdata",au)})}}})}if(am.formatter=="checkbox"){am=$.extend(true,{width:60,align:"center",editoptions:{value:"true:false"}},am)}if(am.stype=="select"||am.formatter=="select"){am.searchoptions.sopt=["eq","ne"];if(am.edittype==undefined){am.edittype="select"}if(am.stype==undefined){am.stype="select"}if(am.formatter==undefined){am.formatter="select"}am.editoptions=$.extend(true,{optionsurl:am.searchoptions.optionsurl,value:am.searchoptions.value},am.editoptions)}if(am.editoptions.optionsurl){am.editoptions.value=Util.remoteSelectOptions(am.editoptions.optionsurl,ad.closest(".panel-content"))}if(typeof am.editoptions.value==="function"){am.editoptions.value=am.editoptions.value.call(ad)}if(am.editoptions.value&&am.searchoptions.value==undefined){am.searchoptions.value=am.editoptions.value}if(!am.hidden){if(am.width){Q+=am.width}else{Q+=300}}if(am.hasOwnProperty("searchoptions")){var an=am.searchoptions;if(an.hasOwnProperty("defaultValue")){R[R.length++]={field:am.index,op:"bw",data:an.defaultValue}}}I.colModel[ap]=am});if(!O){I.colModel.push({label:"流水号",name:"id",hidden:true});if(I.colNames){I.colNames.push("流水号")}}if(c=="items"){I.colModel.push({name:"extraAttributes.dirtyRow",hidden:true,hidedlg:true});if(I.colNames){I.colNames.push("extraAttributes.dirtyRow")}I.colModel.push({name:"_arrayIndex",hidedlg:true,hidden:true});if(I.colNames){I.colNames.push("_arrayIndex")}I.colModel.push({name:"extraAttributes.operation",hidedlg:true,hidden:true});if(I.colNames){I.colNames.push("extraAttributes.operation")}}var p=$(".theme-panel .grid-shrink-option").val();if(p=="true"){I.shrinkToFit=true}else{if(Number(Q)>Number(ad.parent().width())){$.each(I.colModel,function(an,am){if(!am.hidden){if(am.width==undefined){am.width=300}}});I.shrinkToFit=false}}var ac=false;if(ad.closest(".ui-subgrid").size()==0&&c!="items"){if(I.height==undefined||I.height=="auto"){ac=true;I.height=0}}if(I.filterToolbar){var A=I.postData||{};var y={};if(A.hasOwnProperty("filters")){y=JSON.parse(A.filters)}var m=[];if(y.hasOwnProperty("rules")){m=y.rules}$.each(R,function(an,am){var ao=false;$.each(m,function(ap,aq){if(am.field==aq.field){ao=true;return}});if(ao==false){m.push(am)}});y.groupOp="AND";y.rules=m;A._search=true;A.filters=JSON.stringify(y)}if(I.jqPivot){var N=I.jqPivot;delete I.jqPivot;var l=I.url;I={multiselect:false,pager:I.pager,shrinkToFit:false};ad.jqGrid("jqPivot",l,N,I,{reader:"content"});return}else{ad.jqGrid(I)}if(I.filterToolbar){ad.jqGrid("filterToolbar",I.filterToolbar);var B=$("#jqgh_"+ad.attr("id")+"_rn");var M='<a href="javascript:;" title="显示快速查询"><span class="ui-icon ui-icon-carat-1-s"></span></a>';var V='<a href="javascript:;" title="隐藏快速查询"><span class="ui-icon ui-icon-carat-1-n"></span></a>';if(I.subGrid||I.filterToolbar=="hidden"){B.html(M);ad[0].toggleToolbar()}else{B.html(V)}B.on("click",".ui-icon-carat-1-s",function(){B.html(V);ad[0].toggleToolbar()});B.on("click",".ui-icon-carat-1-n",function(){B.html(M);ad[0].toggleToolbar()})}if(I.setGroupHeaders){ad.jqGrid("setGroupHeaders",$.extend(true,{useColSpanStyle:true},I.setGroupHeaders))}ad.bindKeys({upKey:false,downKey:false,onEnter:function(an){if(an==undefined){return}ad.find("tr.jqgrow").attr("tabindex",-1);var am=ad.find("tr.jqgrow[id='"+an+"']");am.attr("tabindex",0);if(I.editurl){if(am.attr("editable")=="1"){J.find(".ui-pg-div span.ui-icon-disk").click()}else{J.find(".ui-pg-div span.ui-icon-pencil").click()}return false}}});if(I.pager){var J=$(I.pager);var ak=Util.notSmallViewport();if(ak){ak=(c=="items"?false:true)}var af=Util.notSmallViewport();if(af){af=(c=="items"?false:true)}ad.jqGrid("navGrid",I.pager,{edit:false,add:false,del:false,refresh:ak,search:ak,position:"right",cloneToTop:true});if(I.columnChooser){var d={caption:"",buttonicon:"ui-icon-battery-2",position:"first",title:"设定显示列和顺序",onClickButton:function(){var am=ad.jqGrid("getGridParam","width");ad.jqGrid("columnChooser",{width:470,done:function(an){if(an){this.jqGrid("remapColumns",an,true);ad.jqGrid("setGridWidth",am,false)}else{}}})}};ad.jqGrid("navButtonAdd",I.pager,d);if(I.pager&&I.toppager){ad.jqGrid("navButtonAdd",I.toppager,d)}}if(Util.notSmallViewport()&&I.exportExcelLocal&&c!="items"){var d={caption:"",buttonicon:"ui-icon-arrowthickstop-1-s",position:"first",title:"导出当前显示数据",onClickButton:function(){ad.jqGrid("exportExcelLocal",I.exportExcelLocal)}};if(I.pager){ad.jqGrid("navButtonAdd",I.pager,d);if(I.toppager){ad.jqGrid("navButtonAdd",I.toppager,d)}}}var K={caption:"",buttonicon:"ui-icon-arrowstop-1-w",position:"first",title:"收缩显示模式",onClickButton:function(){var am=ad.jqGrid("getGridParam","width");ad.jqGrid("destroyFrozenColumns");ad.jqGrid("setGridWidth",am,true)}};if(I.pager){ad.jqGrid("navButtonAdd",I.pager,K);if(I.toppager){ad.jqGrid("navButtonAdd",I.toppager,K)}}if(I.gridDnD){var ag=$.extend(true,{dropbyname:true,beforedrop:function(am,ao,an){an.id=$(ao.draggable).attr("id");return an},autoid:function(am){return am.id},drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover",greedy:true},ondrop:function(aq,at,au){var ao=$("#"+this.id);var am=ao.closest(".ui-subgrid");var ar="";if(am.size()>0){ar=am.prev(".jqgrow").attr("id")}var ap=$(at.draggable).attr("id");var an={};an[I.parent]=ar;an.id=ap;ao.ajaxPostURL(I.editurl,function(){return true},false,{data:an})}},I.gridDnD);var t={caption:"",buttonicon:"ui-icon-arrow-4",position:"first",title:"开启拖放移动模式",onClickButton:function(){var am=null;if(ad.closest(".ui-subgrid").size()>0){$topGrid=ad.parent().closest(".ui-jqgrid-btable:not(.ui-jqgrid-subgrid)");am=$topGrid.parent().find(".ui-jqgrid-btable")}else{am=ad.parent().find(".ui-jqgrid-btable")}var ao=[];am.each(function(ap,aq){ao.push("#"+$(this).attr("id"))});var an=ao.reverse();$.each(an,function(aq,au){var at=$.map(ao,function(av){return av!=au?av:null});var ap=$(au);if(at.length>0){var ar=$.extend({connectWith:at.join(",")},ag);ap.jqGrid("gridDnD",ar);console.log(au+"=>"+ar.connectWith)}if(!ap.hasClass("ui-jqgrid-dndtable")){ap.addClass("ui-jqgrid-dndtable")}})}};if(I.pager){ad.jqGrid("navButtonAdd",I.pager,t);if(I.toppager){ad.jqGrid("navButtonAdd",I.toppager,t)}}}if(I.pager&&(I.inlineNav.add||I.inlineNav.edit||I.inlineNav.del)&&I.inlineNav!=false){ad.jqGrid("inlineNav",I.pager,I.inlineNav)}J.find(".navtable").css("float","right");var u=J.find(" .navtable > tbody > tr");ad.jqGrid("navSeparatorAdd",I.pager,{position:"first"});var g=$("<td></td>").prependTo(u);var ab=$('<div class="btn-group dropup btn-group-contexts"><button data-close-others="true" data-delay="1000" data-toggle="dropdown" class="btn btn-xs yellow dropdown-toggle" type="button"><i class="fa fa-cog"></i>  <i class="fa fa-angle-down"></i></button></div>');g.append(ab);ab.wrap('<div class="clearfix jqgrid-options"></div>');U=$('<ul role="menu" class="dropdown-menu"></ul>');U.appendTo(ab);var L=[];var E=[];var x=[];if(I.viewurl){var r=$('<li><a href="javascript:;"><i class="fa fa-credit-card"></i> 查看详情</a></li>');r.children("a").bind("click",function(aq){Util.debug(aq.target+":"+aq.type);aq.preventDefault();var at=ad.getOnlyOneSelectedItem();if(at){var ao="TBD";var ar=ad.jqGrid("getRowData",at);if(I.editcol){ao=ar[I.editcol];if(ao.indexOf("<")>-1&&ao.indexOf(">")>-1){ao=$(ao).text()}}else{ao=ar.id;if(ao.indexOf("<span")>-1){ao=$(ao).text()}}var an=ao.length;if(an>8){ao="..."+ao.substring(an-5,an)}var ap=Util.AddOrReplaceUrlParameter(I.viewurl,"id",at);var am=ad.closest(".tabbable").find(" > .nav");Global.addOrActiveTab(am,{title:"查看: "+ao,url:ap})}});E.push(r)}if(I.fullediturl){if(I.addable==undefined||I.addable!=false){var aa=$('<li><a href="javascript:;" data-toggle="dynamic-tab" data-url="'+I.fullediturl+'"><i class="fa fa-plus-square"></i> 新增数据</a></li>').appendTo(U);L.push(aa);var al=$('<li><a href="javascript:;"><i class="fa fa-copy"></i> 克隆复制</a></li>');al.children("a").bind("click",function(ao){Util.debug(ao.target+":"+ao.type);ao.preventDefault();if(id=ad.getOnlyOneSelectedItem()){var an=Util.AddOrReplaceUrlParameter(I.fullediturl,"id",id);an=an+("&clone=true");var am=ad.closest(".tabbable").find(" > .nav");Global.addOrActiveTab(am,{title:"克隆复制",url:an})}});E.push(al)}}if(I.fullediturl){var q=$('<li><a href="javascript:;"><i class="fa fa-edit"></i> 编辑数据 <span class="badge badge-info">双击</span></a></li>');q.children("a").bind("click",function(aq){Util.debug(aq.target+":"+aq.type);aq.preventDefault();var at=ad.getOnlyOneSelectedItem();if(at){var ao;var ar=ad.jqGrid("getRowData",at);if(I.editcol){ao=ar[I.editcol];if(ao&&ao.indexOf("<")>-1&&ao.indexOf(">")>-1){ao=$(ao).text()}}else{ao=ar.id;if(ao.indexOf("<span")>-1){ao=$(ao).text()}}if(ao==undefined){ao="TBD"}var an=ao.length;if(an>8){ao="..."+ao.substring(an-5,an)}var ap=Util.AddOrReplaceUrlParameter(I.fullediturl,"id",at);var am=ad.closest(".tabbable").find(" > .nav");Global.addOrActiveTab(am,{title:"编辑: "+ao,url:ap})}});E.push(q)}if(I.operations){var o=[];I.operations.call(ad,o);$.each(o,function(){var am=$(this);var an=am.attr("data-position");if(an=="multi"){x.push(am)}else{if(an=="single"){E.push(am)}else{L.push(am)}}})}if(L.length>0){$.each(L,function(){var aq=$(this);var an=aq.children("a");aq.appendTo(U);if(Util.notSmallViewport()){var ap=an.children("i").attr("class");var am="";if(aq.attr("data-text")=="show"){am=an.text()}var ao=$('<button type="button" class="btn btn-xs blue" style="margin-left:5px"><i class="'+ap+'"></i> '+am+"</button>").appendTo(ab.parent());ao.attr("title",aq.text());ao.click(function(){an.click()})}})}if(E.length>0){if(U.find("li").size()>0){U.append('<li class="divider"></li>')}$.each(E,function(){var ao=$(this);var am=ao.children("a");ao.appendTo(U);if(Util.notSmallViewport()&&ao.attr("data-toolbar")=="show"){var am=ao.children("a");var an=am.clone();an.addClass("btn btn-xs blue hidden-xs");an.css({"margin-left":"5px"});an.appendTo(ab.parent());an.click(function(ap){am.click();ap.preventDefault();return false})}})}if(x.length>0){if(U.find("li").size()>0){U.append('<li class="divider"></li>')}$.each(x,function(){var ao=$(this);ao.appendTo(U);if(Util.notSmallViewport()&&ao.attr("data-toolbar")=="show"){var am=ao.children("a");var an=am.clone();an.addClass("btn btn-xs blue");an.css({"margin-left":"5px"});an.appendTo(ab.parent());an.click(function(ap){am.click();ap.preventDefault();return false})}})}if(U.find("li").length==0){ab.hide()}else{U.find("li > a").each(function(am){$(this).attr("role-idx",am)})}if(!Util.notSmallViewport()){var n=J.find(" > .ui-pager-control > .ui-pg-table > tbody");var ae=n.find(" > tr > td").eq(0);ae.attr("align","left");$("<tr/>").appendTo(n).append(ae);var ae=n.find(" > tr > td").eq(0);ae.attr("align","left");$("<tr/>").appendTo(n).append(ae);var ae=n.find(" > tr > td").eq(0);ae.find("> .ui-pg-table").css("float","left");J.height("75px")}else{J.find("#"+J.attr("id")+"_left").css({width:"150px"})}if(I.pager&&I.toppager){var s=ad.attr("id")+"_toppager";var H=$("#"+s);ad.jqGrid("navSeparatorAdd","#"+s,{position:"first"});var b=$("div#"+s+" .ui-pg-table > tbody > tr");var D=b.find("#"+s+"_right");var aj=J.find(".jqgrid-options").parent("td").clone(true);aj.prependTo(D.find("> .ui-pg-table > tbody > tr"));aj.find(".btn-group").removeClass("dropup");D.prependTo(D.parent());var f=b.find("#"+s+"_left");f.css({width:"150px"});f.appendTo(f.parent());var S=f.find(".ui-paging-info");S.css("float","right");H.width(J.width());if(!Util.notSmallViewport()){H.hide()}if(ad.closest(".ui-subgrid").size()>0){$(I.pager).hide()}}var X=$(".theme-panel .context-menu-option").val();if(X=="enable"&&I.contextMenu&&U.find("li").length>0){var Z=$('<div id="'+Y+'" class="context-menu"></div>');U.clone().appendTo(Z);$("body").append(Z);ad.unbind("contextmenu")}}var ai=I.editrulesurl;if(ai==undefined&&I.editurl&&I.editurl!="clientArray"){ai=I.editurl.substring(0,I.editurl.indexOf("!"))+"!buildValidateRules"}if(ai){var w=$("#gbox_"+T.attr("id")+"  .ui-jqgrid-labels");w.ajaxJsonUrl(ai,function(ap){var am=T.jqGrid("getGridParam","colModel");for(var ao in ap){for(var an=0;an<am.length;an++){var at=am[an];if((at.index&&at.index==ao)||(at.name&&at.name==ao)){am[an].editrules=ap[ao];if(am[an].editrules.required==undefined){am[an].editrules.required=false}delete at.editrules.timestamp;if(at.editrules.tooltips){var ar=$('<span class="glyphicon glyphicon-exclamation-sign tooltipster"  title="'+at.editrules.tooltips+'"></span>');var aq=$(".ui-jqgrid-sortable[id*='"+ao+"']",w);if(aq.size()>0){aq.prepend(ar);ar.tooltipster({contentAsHTML:true,offsetY:5,theme:"tooltipster-punk"})}delete at.editrules.tooltips}break}}}})}if(ac){var z=$("#gbox_"+T.attr("id"));var ah=0;var W="div.ui-jqgrid-titlebar,div.ui-jqgrid-hdiv,div.ui-jqgrid-pager,div.ui-jqgrid-toppager,div.ui-jqgrid-sdiv";z.find(W).filter(":visible").each(function(){ah+=$(this).outerHeight()});ah=ah+4;var h=$(window).height()-ad.closest(".ui-jqgrid").offset().top-ah;if(h<300){h=300}ad.setGridHeight(h,true)}Grid.refreshWidth();if(P){ad.jqGrid("setFrozenColumns")}ad.jqGrid("gridResize",{minWidth:500,minHeight:100});ad.closest(".ui-jqgrid").find(".ui-resizable-s").dblclick(function(){var am=ad.jqGrid("getGridParam","height");ad.jqGrid("setGridHeight",ad.height()+17)}).attr("title","鼠标双击可自动扩展显示区域")},refreshWidth:function(){$("table.ui-jqgrid-btable:visible").each(function(){var c=$(this);var d=c.jqGrid("getGridParam","width");var b=c.closest("div.ui-jqgrid").parent("div").width();if(d!=b){c.jqGrid("setGridWidth",b);var e=$(this).jqGrid("getGridParam","groupHeader");if(e){c.jqGrid("destroyGroupHeader");c.jqGrid("setGroupHeaders",e)}}})},initRecursiveSubGrid:function(f,c,e,h){var b=$("<table data-grid='table' class='ui-jqgrid-subgrid'/>").appendTo($("#"+f));var d=b.closest("table.ui-jqgrid-btable").data("gridOptions");d.url=Util.AddOrReplaceUrlParameter(d.url,"search['EQ_"+e+"']",c);d.inlineNav=$.extend(true,{addParams:{addRowParams:{extraparam:{}}}},d.inlineNav);d.inlineNav.addParams.addRowParams.extraparam[e]=c;d.parent=e;if(h){d.postData={}}b.data("gridOptions",d);Grid.initGrid(b);var g=$("#"+f).parent().closest(".ui-jqgrid-btable:not(.ui-jqgrid-subgrid)");if(d.gridDnD&&g.hasClass("ui-jqgrid-dndtable")){$("#"+f).find(".ui-icon-arrow-4:first").click()}},initSubGrid:function(e,d,c){var b=$("<table data-grid='table' class='ui-jqgrid-subgrid'/>").appendTo($("#"+e));b.data("gridOptions",c);Grid.initGrid(b)}}}();